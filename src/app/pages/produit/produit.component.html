<div class="container produits-container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Liste des Produits</h1>
    <button *ngIf="canAddProduct()" class="btn btn-add" routerLink="/admin/addProduit">
      <i class="fas fa-plus me-1"></i> Ajouter un produit
    </button>
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="error" class="alert alert-danger">
    <i class="fas fa-exclamation-triangle"></i> {{ error }}
    <button *ngIf="error.includes('Session')" class="btn btn-sm btn-outline-danger ms-2" (click)="router.navigate(['/login'])">
      Se reconnecter
    </button>
  </div>

  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="text-center">
    <div class="spinner-border text-primary" role="status"></div>
    <p>Chargement des produits...</p>
  </div>

  <!-- Tableau des produits -->
  <div *ngIf="!isLoading && !error">
    <div *ngIf="produits.length === 0" class="alert alert-info">
      <i class="fas fa-info-circle"></i> Aucun produit trouvé.
    </div>

    <table *ngIf="produits.length > 0" class="table table-produits">
      <thead>
        <tr>
          <th>Image</th>
          <th>ID</th>
          <th>Nom</th>
          <th>Description</th>
          <th>Stock</th>
          <th>Prix</th>
          <th>Catégorie</th>
          <th *ngIf="canManageProducts()">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let produit of produits">
          <td>
  <img *ngIf="produit.images?.length" [src]="'http://127.0.0.1:8000/storage/' + produit.images" alt="Produit" class="produit-img">
  <span *ngIf="!produit.images?.length">Aucune image</span>
</td>
          <td class="text-center">{{ produit.id }}</td>
          <td class="text-center">{{ produit.nom }}</td>
          <td class="text-center">{{ produit.description }}</td>
          <td class="text-center">{{ produit.stock }}</td>
          <td class="text-center">{{ produit.prix | currency:'XOF' }}</td>
          <td class="text-center">
            <span class="badge bg-secondary">{{ produit.categorie?.nom || 'Non défini' }}</span>
          </td>
          <td *ngIf="canManageProducts()">
            <div class="btn-group">
              <button class="btn btn-edit btn-sm" [routerLink]="['/admin/updateProduit', produit.id]">
                <i class="fas fa-edit me-1"></i> Modifier
              </button>
              <button class="btn btn-delete btn-sm" (click)="deleteProduit(produit.id)">
                <i class="fas fa-trash me-1"></i> Supprimer
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Info debug -->
  <div *ngIf="currentUser" class="mt-4 small text-muted">
    <strong>Debug:</strong> Connecté en tant que {{ currentUser.nomComplet }} ({{ currentUser.role }})
  </div>
</div>
